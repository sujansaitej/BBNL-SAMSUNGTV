<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBNL - Login</title>
    <!-- Base Styles -->
    <link rel="stylesheet" href="css/base/variable.css">
    <link rel="stylesheet" href="css/base/reset.css">
    <!-- Component Styles -->
    <link rel="stylesheet" href="css/componentes/buttons.css">
    <link rel="stylesheet" href="css/componentes/forms.css">
    <link rel="stylesheet" href="css/componentes/cards.css">
    <link rel="stylesheet" href="css/componentes/remote.css">
    <!-- Page Styles -->
    <link rel="stylesheet" href="css/pages/auth.css">
    <!-- Tizen Web APIs (MUST be first script for Samsung TV) -->
    <script type="text/javascript" src="$WEBAPIS/webapis/webapis.js"></script>
    <!-- Axios Library -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="js/script.js"></script>
    <!-- Remote Control -->
    <script src="js/remote.js"></script>
    <!-- API Files -->
    <script src="js/api/config.js"></script>
    <script src="js/api/auth.js"></script>
</head>

<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-content">
                <h2 class="auth-title">Welcome Back</h2>
                <p class="auth-subtitle">Sign in to continue to your profile</p>

                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active">
                        <span class="step-dot"></span>
                        <span class="step-label">Phone</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step">
                        <span class="step-dot"></span>
                        <span class="step-label">Verify</span>
                    </div>
                </div>

                <form class="auth-form" id="login-form" onsubmit="return false;">
                    <div class="form-group">
                        <label for="phoneNumberInput" class="form-label">Phone Number</label>
                        <div class="phone-input-wrapper">
                            <div class="country-code-select">
                                <span class="country-code">+91</span>
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <input name="mobile" id="phoneNumberInput" type="tel" placeholder="Enter 10 Digit Number"
                                maxlength="10" pattern="[0-9]{10}" required class="phone-input" autocomplete="off">
                        </div>
                    </div>
                    <div id="error-message" class="error-message"></div>
                    <button type="submit" class="btn btn-primary btn-get-otp" id="get-otp-btn">Get OTP</button>
                    <div id="loading-spinner" class="loading-spinner">
                        <span>Sending OTP...</span>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        // Show error message
        function showError(message) {
            var errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(function () {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Handle login form submission
        function submitLoginForm() {
            var mobile = document.getElementById('phoneNumberInput').value.trim();

            if (!mobile) {
                showError('Please enter your mobile number');
                return;
            }

            if (mobile.length !== 10 || !/^[0-9]{10}$/.test(mobile)) {
                showError('Please enter a valid 10-digit mobile number');
                return;
            }

            var btn = document.getElementById('get-otp-btn');
            var spinner = document.getElementById('loading-spinner');

            btn.disabled = true;
            spinner.style.display = 'block';

            // Store mobile for verify page
            sessionStorage.setItem('bbnl_mobile', mobile);

            // Per API docs: userid from config, mobile from user input
            var userid = API_CONFIG.USER_CREDENTIALS.userid;
            AuthAPI.requestOTP(userid, mobile).then(function (result) {
                btn.disabled = false;
                spinner.style.display = 'none';

                if (result.success) {
                    // Store OTP in session for verify page to display
                    if (result.otp) {
                        sessionStorage.setItem('bbnl_otp', result.otp);
                    }
                    // OTP sent successfully - redirect to verify page
                    // (OTP is logged in console for testing)
                    window.location.href = 'verify.html';
                } else {
                    showError(result.message);
                    console.error('API Error:', result);
                }
            }, function (error) {
                btn.disabled = false;
                spinner.style.display = 'none';
                console.error('Request failed:', error);
                showError(error.message || 'Network error. Please check your connection.');
            });
        }

        document.getElementById('login-form').addEventListener('submit', function (e) {
            e.preventDefault();
            submitLoginForm();
        });

        // Initialize remote control
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize remote with auto-focus disabled
            RemoteControl.init({
                focusableSelector: 'input, button:not([disabled]), .btn',
                wrapNavigation: true,
                autoFocus: false,
                debug: false
            });
        });
    </script>
</body>

</html>